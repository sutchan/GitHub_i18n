# 07-开发者文档

## 📋 目录说明

本目录包含 GitHub 中文翻译插件的开发者文档，为希望参与项目开发、贡献代码或了解项目技术实现的开发者提供全面参考。这些文档涵盖从环境搭建到发布流程的完整开发周期。

## 📂 包含文件

- **01-开发环境搭建.md**: 详细说明如何配置本地开发环境
- **02-项目结构说明.md**: 项目代码结构和文件组织详解
- **03-开发流程指南.md**: 推荐的开发工作流程和最佳实践
- **04-翻译词典维护.md**: 如何维护和更新翻译词典
- **05-测试指南.md**: 项目测试方法和最佳实践
- **06-性能优化.md**: 性能优化策略和方法
- **07-安全注意事项.md**: 开发过程中的安全考量和防护措施

## 📝 项目概述

GitHub 中文翻译插件是一个基于 JavaScript 开发的浏览器用户脚本，专注于提供高质量的 GitHub 界面本地化体验。项目采用模块化架构，主要包含两个核心组件：

1. **用户脚本**: 在浏览器中运行的前端代码，负责页面监控、元素检测和智能翻译
2. **自动化工具**: 用于抓取、维护和更新翻译词典的辅助工具集

## 🛠️ 技术栈

- **主要语言**: JavaScript (ES6+)
- **核心 API**: MutationObserver、DOM API、History API
- **开发工具**: Node.js、npm/yarn
- **测试框架**: Jest
- **构建工具**: 自定义构建脚本
- **版本控制**: Git
- **浏览器兼容性**: Chrome 90+, Firefox 88+, Edge 90+

## 🚀 开发环境搭建

### 前置条件

- Node.js (v16 或更高版本，推荐 v18)
- npm 或 yarn (包管理工具)
- Git (版本控制系统)
- 现代浏览器 (Chrome、Firefox、Edge 等)
- 用户脚本管理器 (推荐 Tampermonkey 或 Violentmonkey)

### 基础设置

1. **克隆代码仓库**
   ```bash
   git clone https://github.com/sutchan/GitHub_i18n.git
   cd GitHub_i18n
   ```

2. **安装依赖**
   ```bash
   npm install
   # 或
   yarn install
   ```

3. **构建项目**
   ```bash
   npm run build
   # 或
   yarn build
   ```

4. **安装开发版本**
   - 构建完成后，在 `dist` 目录中找到生成的用户脚本
   - 在本地浏览器中安装该脚本进行测试

## 📁 项目结构

项目采用模块化架构，代码组织清晰，易于维护和扩展。以下是项目的主要目录结构及其职责：

```
GitHub_i18n/           # 项目根目录
├── src/               # 源代码目录（核心代码）
│   ├── config.js      # 配置文件（全局设置和参数）
│   ├── dictionaries/  # 翻译词典（按功能模块分类）
│   │   ├── core.js    # 核心翻译词典
│   │   ├── repository.js # 仓库页面词典
│   │   ├── issues.js  # Issues页面词典
│   │   └── ...        # 其他页面词典
│   ├── translationCore.js # 翻译核心逻辑（文本处理和翻译算法）
│   ├── pageMonitor.js # 页面监控（DOM变化检测和SPA支持）
│   ├── versionChecker.js # 版本检查（自动更新检测）
│   ├── utils.js       # 工具函数（通用功能）
│   └── main.js        # 入口文件（初始化和主流程）
├── dist/              # 构建产物（发布的用户脚本）
├── test/              # 测试文件（单元测试和集成测试）
├── build/             # 构建脚本（编译和打包工具）
├── utils/             # 辅助工具（自动化字符串更新等）
└── docs/              # 项目文档（使用指南和技术说明）
```

## 🔄 开发流程

### 常规开发流程

1. **创建分支**
   ```bash
   git checkout -b feature/your-feature-name
   # 或修复分支
   git checkout -b fix/your-fix-name
   ```

2. **修改代码**
   - 遵循项目代码规范和命名约定
   - 添加详细的函数级注释
   - 确保代码兼容性和性能

3. **运行测试**
   ```bash
   npm test
   # 运行特定测试
   npm test -- -t "your-test-name"
   ```

4. **构建并测试**
   ```bash
   npm run build
   ```
   在浏览器中测试构建后的脚本，确保功能正常

5. **提交更改**
   ```bash
   git add .
   git commit -m "feat: 简短描述你的功能"
   # 或修复提交
   git commit -m "fix: 简短描述你的修复"
   ```
   建议使用语义化提交信息（feat, fix, docs, style, refactor, test, chore）

6. **推送分支**
   ```bash
   git push origin feature/your-feature-name
   ```

7. **创建 Pull Request**
   - 在 GitHub 上创建 PR
   - 详细描述你的更改和目的
   - 引用相关 issues
   - 等待代码审核和合并

### 翻译词典更新流程

1. 编辑 `src/dictionaries/` 目录下的词典文件
2. 遵循词典格式规范
3. 运行测试确保格式正确
4. 提交更改并创建 PR

## 📝 代码规范

### JavaScript 编码规范

- 使用 ES6+ 语法，充分利用现代 JavaScript 特性
- 使用 `const` 和 `let` 而非 `var`，优先使用 `const`
- 优先使用箭头函数简化回调函数
- 代码缩进使用 2 个空格，保持一致性
- 每行不超过 100 个字符，提高可读性
- 函数和变量命名使用 camelCase
- 类名使用 PascalCase
- 使用模板字符串而非字符串拼接
- 避免使用不必要的嵌套三元运算符
- 使用对象解构和数组解构简化代码

### 注释规范

- 添加详细的函数级注释，遵循 JSDoc 格式
- 复杂逻辑添加内联注释，解释实现意图
- 代码修改时同步更新相关注释
- 为重要的常量和配置项添加注释说明
- 文件顶部添加简短的文件描述注释

### 安全规范

- 禁止使用 `innerHTML` 进行 DOM 操作，使用 `textContent` 或 `appendChild`
- 对所有用户输入和外部数据进行适当的验证和转义
- 避免 ReDoS 攻击，检查正则表达式中的贪婪量词
- 确保网络请求设置适当的安全头
- 避免在代码中硬编码敏感信息

## 🧪 测试指南

### 单元测试

```bash
# 运行所有测试
npm test

# 运行特定测试套件
npm test -- -t "translationCore"

# 运行测试并生成覆盖率报告
npm run test:coverage
```

所有新功能都应该有对应的单元测试，测试覆盖率目标为 80% 以上。

### 集成测试

- 构建项目后，在浏览器中安装并测试完整功能
- 确保在不同浏览器中测试兼容性
- 验证各种 GitHub 页面类型的翻译效果

### 性能测试

使用浏览器开发工具监控插件性能，特别关注：
- 页面加载时间和脚本执行时间
- JavaScript 内存使用情况
- 翻译操作对页面交互流畅度的影响
- DOM 操作频率和复杂度

## 🔧 调试技巧

### 浏览器调试

1. 打开浏览器开发工具 (F12)
2. 在 Console 面板查看日志输出和错误信息
3. 在 Sources 面板找到并设置断点进行调试
4. 使用 Performance 面板分析性能瓶颈
5. 利用 Elements 面板实时修改 DOM 进行测试

### 本地开发模式

开发时可以使用开发模式，启用详细日志和调试功能：

```javascript
// 在 config.js 中设置
const DEBUG = true;
const LOG_LEVEL = 'verbose'; // 'error', 'warn', 'info', 'debug', 'verbose'
```

### 翻译调试

调试翻译问题的有效方法：

```javascript
// 在翻译前后添加调试日志
function debugTranslation(element, originalText, translatedText) {
  if (DEBUG && originalText !== translatedText) {
    console.log(`翻译: "${originalText}" -> "${translatedText}"`);
    console.log('元素:', element);
  }
}
```

### 常见问题排查

- 使用 `console.time()` 和 `console.timeEnd()` 测量函数执行时间
- 使用 Chrome DevTools 的 Performance 面板分析长任务
- 使用 Memory 面板检查内存泄漏
- 使用 `debugger;` 语句在特定代码位置添加断点

## 🤝 贡献指南

我们非常欢迎各种形式的贡献，无论是代码、翻译、文档还是测试反馈！

### 代码贡献

- **修复 bug**：识别并修复现有问题，提高稳定性
- **实现新功能**：开发新特性，增强用户体验
- **性能优化**：改进代码性能，提升响应速度
- **重构代码**：优化代码结构，提高可维护性

### 翻译贡献

- **改进翻译质量**：优化现有翻译，使其更加准确自然
- **补充缺失翻译**：识别并添加未翻译的字符串
- **校正错误翻译**：修正翻译不准确或不适用的内容
- **翻译术语规范化**：统一专业术语的翻译

### 文档贡献

- **改进现有文档**：更新和优化已有文档内容
- **编写新文档**：创建新的使用指南或技术说明
- **修正文档错误**：修复文档中的错误和不一致之处
- **添加示例**：提供代码示例和使用案例

### 测试贡献

- **编写测试用例**：为现有功能添加单元测试
- **报告 bug**：提交详细的问题报告，包含复现步骤
- **提供使用反馈**：分享使用体验和改进建议
- **性能测试**：进行性能测试并提供优化建议

详细的贡献流程请参考 [项目贡献指南](../10-附录/03-贡献指南.md)。

## 🚀 版本发布流程

项目采用语义化版本控制（SemVer）规范：MAJOR.MINOR.PATCH

### 发布准备

1. **更新版本号**
   ```bash
   # 升级补丁版本（向后兼容的修复）
   npm run build:patch
   
   # 升级次版本（向后兼容的新功能）
   npm run build:minor
   
   # 升级主版本（不兼容的 API 变更）
   npm run build:major
   ```

2. **更新变更日志**
   - 在 CHANGELOG.md 中记录本次发布的主要变更
   - 分类记录新功能、修复和优化
   - 引用相关的 issue 或 PR

3. **运行测试确保功能正常**
   ```bash
   npm test
   ```

4. **构建项目**
   ```bash
   npm run build
   ```

### 发布流程

1. **创建发布标签**
   ```bash
   git tag v1.x.x
   git push origin v1.x.x
   ```

2. **发布到 GitHub**
   - 在 GitHub 上创建新的 Release
   - 上传构建的用户脚本
   - 复制 CHANGELOG 中的内容作为发布说明

3. **发布到用户脚本平台**
   - 更新 Greasy Fork 上的脚本版本
   - 更新其他相关用户脚本平台

4. **通知社区**
   - 在讨论区发布新版本公告
   - 在社交媒体分享更新信息

## ❓ 常见开发问题

### 翻译不生效

- **词典格式检查**：确认翻译词典格式正确，键值对格式无误
- **选择器匹配问题**：使用浏览器开发工具确认选择器能够正确匹配目标元素
- **页面监控逻辑**：检查页面监控代码是否正常工作，特别是 SPA 路由变化处理
- **翻译条件**：确认元素满足翻译条件，没有被过滤规则排除

### 性能问题

- **DOM 操作优化**：减少不必要的 DOM 查询和修改，使用缓存策略
- **正则表达式优化**：避免使用贪婪量词，简化复杂表达式
- **节流和防抖**：对频繁触发的事件实现节流或防抖机制
- **惰性加载**：实现按需加载，只在需要时执行翻译操作
- **批量处理**：将多个 DOM 操作合并为批量处理

### 兼容性问题

- **浏览器兼容性**：测试不同浏览器的兼容性，特别关注较老版本
- **用户脚本管理器**：确保兼容不同的用户脚本管理器（Tampermonkey、Violentmonkey 等）
- **GitHub 界面变化**：定期检查 GitHub 界面变化，及时更新选择器和逻辑

## 📞 联系与支持

- **GitHub Issues**: [提交问题](https://github.com/sutchan/GitHub_i18n/issues)
- **讨论区**: [参与讨论](https://github.com/sutchan/GitHub_i18n/discussions)
- **代码审查**: 对提交的 PR 提供建设性的反馈

## 🔖 版本信息

- **当前版本**: 1.8.99
- **发布日期**: 2024-01
- **文档状态**: 活跃维护中
- **开发状态**: 持续迭代

---

*详细的开发指南请参考各子文档。如有开发相关问题，请提交 issue 或参与项目讨论。*