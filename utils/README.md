# GitHub 自动化字符串更新工具

此工具用于自动化从 GitHub 网站抓取字符串并更新翻译词典，帮助维护者持续更新 GitHub 中文翻译词典。

## 功能特点

- 自动从多个 GitHub 核心页面抓取文本字符串
- 根据页面类型智能分类字符串到相应模块
- 自动更新翻译词典，避免重复添加已存在的字符串
- 自动备份原始文件，确保安全
- 自动升级版本号
- 支持请求重试和超时处理，提高稳定性
- 支持调试模式，保存抓取结果供分析
- 增强的错误处理机制，包括输入验证、异常捕获和友好的错误提示
- 健壮的 API 端点测试工具，支持超时检测和自动重试
- 完善的状态管理，确保工具在各种情况下都能正常工作

## 安装依赖

```bash
npm install
```

这会安装包括 jsdom、express、cors 和 morgan 在内的所有必要依赖。

## 配置说明

工具配置可以通过两种方式进行：

### 1. 通过 HTML 界面配置

HTML 界面提供了友好的配置表单，可以实时保存配置。

### 2. 通过配置文件配置

配置文件位于`auto_string_updater`目录下：

- **config.json**: 存储主要配置参数
- **pages.json**: 存储要抓取的 GitHub 页面列表

主要配置项包括：

- **userScriptPath**: 用户脚本文件路径
- **backupDir**: 备份文件存储目录
- **minStringLength/maxStringLength**: 字符串长度过滤范围
- **httpTimeout**: HTTP 请求超时时间(毫秒)
- **maxRetries**: 请求失败最大重试次数
- **retryDelay**: 请求重试间隔(毫秒)
- **userAgent**: HTTP 请求 User-Agent 头
- **debugMode**: 是否启用调试模式
- **debugOutputFile**: 调试信息输出文件路径

## 使用方法

### 方法一：通过 HTML 界面操作（推荐）

HTML 界面提供了友好的操作体验，包括实时日志查看、配置管理和页面管理等功能。

#### Windows 用户

1. 直接双击运行`start.bat`文件，这会自动安装依赖并启动服务器
2. 打开浏览器，访问 http://localhost:3000

#### 手动启动

1. 安装依赖

```bash
cd auto_string_updater
npm install
```

2. 启动服务器

```bash
npm run server
```

3. 打开浏览器，访问 http://localhost:3000

### 方法二：命令行方式

1. 安装依赖

```bash
cd auto_string_updater
npm install
```

2. 运行工具

```bash
node auto_string_updater.js
# 或使用npm脚本
npm start
```

### 定期自动运行

可以通过系统任务计划或 cron 设置定期运行：

**Windows 任务计划**:

1. 打开任务计划程序
2. 创建基本任务，设置触发器(如每周一凌晨 2 点)
3. 操作设置为启动程序
4. 程序/脚本设置为`node.exe`的完整路径
5. 添加参数设置为`auto_string_updater.js`的完整路径
6. 起始于设置为脚本所在目录

**Linux/macOS cron**:

```bash
# 每周一凌晨2点运行
0 2 * * 1 cd /path/to/GitHub_i18n/auto_string_updater && node auto_string_updater.js
```

## HTML 操作界面功能说明

HTML 界面提供了以下主要功能：

### 1. 配置管理

- **基本设置**: 用户脚本路径、备份目录、字符串长度过滤
- **HTTP 设置**: 请求超时、重试次数、延迟、用户代理
- **调试设置**: 调试模式开关、调试输出文件路径

### 2. 页面管理

- 添加新的 GitHub 页面进行抓取
- 编辑现有页面的配置（URL、选择器、模块）
- 删除不需要的页面配置

### 3. 工具操作

- 一键启动工具
- 实时查看运行日志
- 随时停止运行中的任务
- 查看统计数据（提取的字符串数量、新增字符串数量、上次更新时间）

### 4. 辅助功能

- 保存和加载配置
- 重置为默认配置
- 查看帮助文档
- 快速查看备份文件位置

## 界面操作指南

1. **启动工具**:

   - 点击"开始抓取"按钮
   - 实时查看运行日志
   - 可以随时点击"停止抓取"按钮中断操作

2. **配置管理**:

   - 修改配置参数后，点击"保存配置"按钮
   - 如需恢复默认设置，点击"重置配置"按钮

3. **页面管理**:

   - 点击"添加页面"按钮添加新的 GitHub 页面
   - 点击表格中的编辑图标修改页面配置
   - 点击表格中的删除图标移除页面配置

4. **查看统计**:
   - 界面底部会显示最近一次运行的统计数据
   - 包括：提取的字符串总数、新增的字符串数、上次更新时间

## 注意事项

1. 新添加的字符串会标记为"待翻译: [原字符串]"，需要手动进行翻译
2. 过度频繁的请求可能会触发 GitHub 的访问限制，建议合理设置抓取频率
3. 如果需要抓取更多页面，可以在`CONFIG.GITHUB_PAGES`中添加
4. 对于需要登录才能访问的页面，可能需要修改`REQUEST_HEADERS`添加 Cookie
5. 运行前请确保有足够的文件系统权限

## 故障排除

- **请求失败**: 检查网络连接和代理设置，可能需要调整请求头
- **文件访问错误**: 确认文件路径正确且有读写权限
- **字符串重复**: 工具会自动去重，但如果发现重复字符串，可以手动清理
- **GitHub 限制**: 减少抓取频率，增加请求间隔

## 高级定制

- **增加页面**: 在`CONFIG.GITHUB_PAGES`数组中添加新的页面配置
- **修改选择器**: 调整页面配置中的`selector`属性以改变抓取范围
- **调整过滤规则**: 修改字符串长度限制和正则表达式过滤条件
- **自定义请求头**: 根据需要调整`REQUEST_HEADERS`以模拟不同浏览器

## 作者信息

作者: SutChan
版本: 1.0.1
