# GitHub字符串自动更新工具使用说明\n\n## 工具概述\n\n`auto_string_updater.js`是一个用于自动化从GitHub网站抓取字符串并更新翻译词典的工具。它可以定期运行，帮助维护者持续更新GitHub中文翻译词典，确保翻译覆盖最新的GitHub界面元素。\n\n## 主要功能\n\n- 自动从多个GitHub页面抓取新的UI字符串\n- 使用JSDOM进行HTML解析，提取更精确的文本\n- 智能分类字符串到不同的翻译模块\n- 自动跳过已存在于翻译词典中的字符串\n- 支持HTTP请求重试和超时处理\n- 自动创建文件备份，确保数据安全\n- 提供详细的调试日志和提取结果保存\n- 自动更新脚本版本号\n- 可选的Git自动提交功能\n- 新增状态重置功能，解决工具卡住问题\n\n## 安装依赖\n\n在运行脚本之前，需要安装必要的依赖包：\n\n```bash\nnpm install jsdom\n```\n\n## 配置说明\n\n脚本中的配置项位于`CONFIG`对象中，可以根据需要进行调整：\n\n```javascript\nconst CONFIG = {\n    // 重试配置\n    retry: {\n        maxAttempts: 3,      // 最大重试次数\n        delay: 1000,         // 重试延迟时间（毫秒）\n        timeout: 30000       // 请求超时时间（毫秒）\n    },\n    // 调试配置\n    debug: {\n        enabled: true,       // 是否启用调试模式\n        saveExtractedStrings: true,  // 是否保存提取的字符串\n        saveHtmlPages: false         // 是否保存下载的HTML页面\n    },\n    // GitHub请求头\n    headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)...',\n        // 其他请求头...\n        // 如果需要，可以在这里添加Cookie：'Cookie': 'your_github_cookie_here'\n    }\n};\n```\n\n### 配置说明：\n\n1. **retry**：控制网络请求的重试行为\n   - `maxAttempts`：网络请求失败时的最大重试次数\n   - `delay`：每次重试之间的延迟时间（毫秒）\n   - `timeout`：请求超时时间（毫秒）\n\n2. **debug**：控制调试功能\n   - `enabled`：是否启用调试模式\n   - `saveExtractedStrings`：是否将提取的字符串保存到调试文件\n   - `saveHtmlPages`：是否保存下载的完整HTML页面（可能会占用较多磁盘空间）\n\n3. **headers**：HTTP请求头配置\n   - `User-Agent`：模拟浏览器请求头\n   - 其他标准HTTP头\n   - 可选的`Cookie`：如果GitHub限制了未登录用户的访问，可以添加登录后的Cookie\n\n## 要抓取的页面配置\n\n脚本中定义了要抓取的GitHub页面列表：\n\n```javascript\nconst GITHUB_PAGES = [\n    'https://github.com/',\n    'https://github.com/settings/profile',\n    'https://github.com/settings/admin',\n    'https://github.com/settings/accessibility',\n    'https://github.com/settings/notifications',\n    'https://github.com/search',\n    'https://github.com/notifications',\n    'https://github.com/features/codespaces',\n    // 更多页面...\n];\n```\n\n您可以根据需要添加或移除页面。\n\n## 使用方法\n\n### 通过Web界面使用\n\n1. 启动服务器：\n   ```bash\n   node utils/server.js\n   ```\n\n2. 在浏览器中打开服务器显示的地址（通常是 http://localhost:3004）\n\n3. 配置参数和要抓取的页面\n\n4. 点击"开始抓取字符串"按钮运行工具\n\n5. 查看实时日志和进度信息\n\n6. 如果遇到工具卡住无法开始新任务的情况，可以点击"重置工具状态"按钮清除运行锁\n\n### 命令行直接运行\n\n在项目目录下直接运行脚本：\n\n```bash\nnode utils/auto_string_updater.js\n```\n\n### 定期自动运行\n\n可以通过Windows任务计划程序或Linux的cron任务设置定期运行脚本。\n\n#### Windows系统：\n\n1. 创建一个批处理文件（例如`run_auto_updater.bat`）：\n   ```batch\n   @echo off\n   cd /d "e:\Dropbox\GitHub\GitHub_i18n"\n   node auto_string_updater.js\n   ```\n\n2. 通过Windows任务计划程序，将此批处理文件设置为定期运行（例如每周一次）。\n\n#### Linux/Mac系统：\n\n使用cron任务设置定期运行：\n\n```bash\n# 编辑cron任务\ncrontab -e\n\n# 添加每周运行一次的任务（例如每周一凌晨2点）\n0 2 * * 1 cd /path/to/GitHub_i18n && node auto_string_updater.js\n```\n\n## 输出说明\n\n脚本运行时会输出详细的日志信息，包括：\n\n- 正在下载的页面URL\n- 从每个页面提取的字符串数量\n- 新发现的未翻译字符串数量\n- 字符串添加到的模块信息\n- 文件备份路径\n- 调试文件保存路径\n- 操作完成状态\n\n## 调试功能\n\n当启用调试模式时，脚本会在`debug`目录下保存以下信息：\n\n- `extracted_strings_时间戳.txt`：包含所有提取的新字符串\n- `页面URL_替换后的名称_extracted_strings.txt`：每个页面提取的字符串及其来源选择器\n\n这些文件可以帮助您检查提取的字符串质量和来源。\n\n## 注意事项\n\n1. 由于GitHub可能有访问限制，建议不要过于频繁地运行脚本（建议每周或每月运行一次）\n\n2. 如果遇到持续的连接超时问题，可以尝试：\n   - 添加有效的GitHub登录Cookie到配置中\n   - 增加重试次数和超时时间\n   - 减少每次运行时抓取的页面数量\n\n3. 脚本会自动将新字符串的翻译设置为"待翻译：原文本"，请在运行后手动完善这些翻译\n\n4. 为了确保数据安全，脚本会在每次运行前创建源文件的备份\n\n5. Git自动提交功能是可选的，如果不需要可以注释掉相关代码\n\n## 常见问题解决\n\n### 问题1：连接超时错误\n\n**症状**：`connect ETIMEDOUT` 或 `下载页面超时`错误\n\n**解决方案**：\n- 检查网络连接\n- 添加GitHub登录Cookie\n- 增加重试次数和超时时间\n- 减少并发请求数量\n\n### 问题4：工具卡住无法开始新任务\n\n**症状**：点击"开始抓取字符串"按钮没有反应，或显示"工具已经在运行中"但实际上没有任务在运行\n\n**解决方案**：\n- 点击Web界面上的"重置工具状态"按钮强制清除运行锁\n- 确认对话框出现后，点击"确定"完成重置\n- 重置后，工具状态将恢复为"就绪"，可以重新开始新任务\n\n### 问题2：提取的字符串质量不高\n\n**症状**：提取了很多不需要翻译的文本或重复的文本\n\n**解决方案**：\n- 调整`isValidString`函数中的过滤条件\n- 更新`extractStrings`函数中的选择器列表\n- 增加或修改模块分类函数\n\n### 问题3：无法正确添加到翻译词典\n\n**症状**：提取了字符串但未添加到正确的模块\n\n**解决方案**：\n- 检查模块名称是否与翻译文件中的模块名称一致\n- 更新模块分类函数的关键词列表\n- 检查正则表达式是否正确匹配模块位置\n\n## 高级定制\n\n### 添加新的页面\n\n编辑`GITHUB_PAGES`数组，添加新的GitHub页面URL。\n\n### 添加新的模块\n\n1. 在`addStringsToDictionary`函数的`modules`对象中添加新的模块\n2. 创建对应的分类函数（例如`isNewModuleString`）\n3. 确保翻译文件中存在对应的模块\n\n### 调整选择器\n\n编辑`extractStrings`函数中的`selectors`数组，添加或修改CSS选择器以提高字符串提取的准确性。\n\n## 版本更新记录\n\n| 版本 | 更新内容 |\n|------|---------|\n| 1.0.0 | 初始版本，基本的字符串抓取和更新功能 |\n| 1.1.0 | 添加了重试机制和超时处理 |\n| 1.2.0 | 增加了模块分类功能 |\n| 1.3.0 | 添加了调试功能和详细日志 |\n| 1.4.0 | 增加了Git自动提交功能 |\n| 1.5.0 | 优化了字符串过滤和提取逻辑 |\n| 1.6.0 | 添加了工具状态重置功能，优化了进程管理逻辑，解决工具卡住问题\n\n## 作者\n\nSutChan